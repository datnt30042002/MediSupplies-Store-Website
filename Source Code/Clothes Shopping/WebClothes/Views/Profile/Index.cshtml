@model ProfileModel
@{
    ViewData["Title"] = "Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    @*<title>Clothing Online Shop</title>*@
    <title>Doctris - Doctor Appointment Booking System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Premium Bootstrap 4 Landing Page Template" />
    <meta name="keywords" content="Appointment, Booking, System, Dashboard, Health" />
    <meta name="author" content="Shreethemes" />
    <meta name="email" content="support@shreethemes.in" />
    <meta name="website" content="https://shreethemes.in" />
    <meta name="Version" content="v1.2.0" />
    <!-- favicon -->
    <link rel="shortcut icon" href="/lib/images/favicon.ico.png">
    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Icons -->
    <link href="/css/materialdesignicons.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/remixicon.css" rel="stylesheet" type="text/css" />
    <link href="https://unicons.iconscout.com/release/v3.0.6/css/line.css" rel="stylesheet">
    <!-- Css -->
    <link href="/css/style.min.css" rel="stylesheet" type="text/css" id="theme-opt" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>
        .alert {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

            .alert.show {
                opacity: 1;
            }

        .confirmation-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1050;
            background-color: white;
            padding: 40px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            display: none;
            text-align: center;
        }

            .confirmation-modal h5 {
                margin-top: 0;
                color: #dc3545;
                font-size: 24px;
            }

            .confirmation-modal p {
                margin-bottom: 20px;
                font-size: 18px;
            }

            .confirmation-modal .button-container {
                display: flex;
                justify-content: flex-end;
            }

            .confirmation-modal button {
                margin-left: 10px;
                font-size: 16px;
            }
    </style>
</head>
<body>

    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner">
                <div class="double-bounce1"></div>
                <div class="double-bounce2"></div>
            </div>
        </div>
    </div>
    <!-- Loader -->
    <!-- Start -->
    <section class="bg-dashboard">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xl-4 col-lg-4 col-md-5 col-12">
                    <div class="rounded shadow overflow-hidden sticky-bar">
                        <div class="card border-0">
                            <img src="/lib/images/doctors/profile-bg.jpg" class="img-fluid" alt="">
                        </div>

                        <div class="text-center avatar-profile margin-nagative mt-n5 position-relative pb-4 border-bottom">
                            <img src="@Url.Content("~/Avatars/" + Model.Avatar)" class="rounded-circle shadow-md avatar avatar-md-md" alt="">
                            <h5 class="mt-3 mb-1">@Model.FullName</h5>
                            <p class="text-muted mb-0">@Model.RoleName?.ToUpper()</p>
                        </div>

                        <div class="list-unstyled p-4 border-bottom">
                            <div class="progress-box mb-4">
                                <h6 class="title">Complete your profile</h6>
                                <br>
                                <div class="progress">
                                    <div class="progress-bar position-relative bg-primary" style="width:@Model.CompletionPercentage%;">
                                        <div class="progress-value d-block text-muted h6">@Model.CompletionPercentage%</div>
                                    </div>
                                </div>
                            </div><!--end process box-->

                            <div class="d-flex align-items-center mt-2">
                                <i class="uil uil-user align-text-bottom text-primary h5 mb-0 me-2"></i>
                                <h6 class="mb-0">Gender</h6>
                                <p class="text-muted mb-0 ms-2">@(Model.Gender.HasValue ? (Model.Gender.Value ? "Male" : "Female") : string.Empty)</p>
                            </div>

                            <div class="d-flex align-items-center mt-2">
                                <i class="uil uil-calender align-text-bottom text-primary h5 mb-0 me-2"></i>
                                <h6 class="mb-0">Birthday</h6>
                                <p class="text-muted mb-0 ms-2">@(Model.Birthday.HasValue ? Model.Birthday.Value.ToString("dd/MM/yyyy") : string.Empty)</p>
                            </div>

                            <div class="d-flex align-items-center mt-2">
                                <i class="uil uil-book-open align-text-bottom text-primary h5 mb-0 me-2"></i>
                                <h6 class="mb-0">Phone No.</h6>
                                <p class="text-muted mb-0 ms-2">@Model.PhoneNumber</p>
                            </div>

                            <div class="d-flex align-items-center mt-2">
                                <i class="uil uil-italic align-text-bottom text-primary h5 mb-0 me-2"></i>
                                <h6 class="mb-0">Address</h6>
                                <p class="text-muted mb-0 ms-2">@Model.Address</p>
                            </div>
                        </div>

                        <ul class="list-unstyled sidebar-nav mb-0 align-items-center mt-2" style="padding-left:13px">
                            <li class="navbar-item"><a href="@Url.Action("Index", "Profile")" class="navbar-link"><i class="uil uil-user me-2 d-inline-block"></i> Profile Settings</a></li>
                            <li class="navbar-item"><a href="#" class="navbar-link"><i class="uil uil-bill me-2 d-inline-block"></i> My Orders</a></li>
                            <li class="navbar-item"><a href="@Url.Action("Index", "ForgotPassword")" class="navbar-link"><i class="uil uil-envelope-redo me-2 d-inline-block"></i> Forgot Password</a></li>
                            <li class="navbar-item"><a href="@Url.Action("Index", "Logout")" class="navbar-link"><i class="uil uil-sign-out-alt me-2 d-inline-block"></i> Log out</a></li>
                        </ul>

                    </div>
                </div><!--end col-->

                <div class="col-xl-8 col-lg-8 col-md-7 mt-4 pt-2 mt-sm-0 pt-sm-0">
                    <h4 class="mb-0 pb-2" style="text-align:center">Profile Settings</h4>
                    <div class="rounded shadow mt-4">
                        <div class="p-4 border-bottom">
                            <h5 class="mb-0">Personal Information :</h5>
                        </div>
                        @using (Html.BeginForm("UpdateProfile", "Profile", FormMethod.Post, new { enctype = "multipart/form-data" }))
                        {
                            @Html.AntiForgeryToken()
                            <div class="p-4 border-bottom">
                                <div class="row align-items-center">
                                    <div class="col-lg-2 col-md-4">
                                        <img src="@Url.Content("~/Avatars/" + Model.Avatar)" id="uploadedImage" class="avatar avatar-md-md rounded-pill shadow mx-auto d-block" alt="" style="display:none;">
                                    </div><!--end col-->

                                    <div class="col-lg-5 col-md-8 text-center text-md-start mt-4 mt-sm-0">
                                        <h5 class="">Upload your picture</h5>
                                        <p class="text-muted mb-0">For best results, use an image at least 256px by 256px in either .jpg or .png format</p>
                                    </div><!--end col-->

                                    <div class="col-lg-5 col-md-12 text-lg-end text-center mt-4 mt-lg-0">
                                        <input type="file" name="avatarFile" id="uploadImageInput" style="display:none" accept="image/*">
                                        <a href="#" class="btn btn-primary" onclick="document.getElementById('uploadImageInput').click()">Upload</a>
                                        <a href="#" class="btn btn-soft-primary ms-2" onclick="removeImage()">Remove</a>
                                    </div><!--end col-->
                                @Html.ValidationMessageFor(m => m.Avatar)
                                </div><!--end row-->
                            </div>

                            <div class="p-4">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Full Name</label>
                                            @Html.TextBoxFor(m => m.FullName, new { @class = "form-control", placeholder="Full Name :"})
                                            @Html.ValidationMessageFor(m => m.FullName)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Your Email</label>
                                            <input style="pointer-events: none; background-color: #cccccc" readonly name="email" id="email" type="email" class="form-control" placeholder="Your email :" value="@Model.Email">
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Date Of Birth</label>
                                            @Html.TextBoxFor(m => m.Birthday, new { @class = "form-control datepicker", placeholder="Date Of Birth :", type = "date", id = "dob" })
                                            @Html.ValidationMessageFor(m => m.Birthday)
                                            @if (Model.Birthday.HasValue)
                                            {
                                                <script>
                                                    document.getElementById("dob").value = "@Model.Birthday.Value.ToString("yyyy-MM-dd")";
                                                </script>
                                            }
                                        </div>
                                    </div><!--end col-->


                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Gender</label>
                                            @Html.DropDownListFor(m => m.Gender, new SelectList(new[]
                                        {
                                        new { Text = "Male", Value = true },
                                        new { Text = "Female", Value = false }
                                        }, "Value", "Text"), new { @class = "form-control form-select" })
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Address</label>
                                            @Html.TextAreaFor(m => m.Address, new { @class = "form-control", placeholder="Your address :",  rows="3" })
                                            @Html.ValidationMessageFor(m => m.Address)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Phone</label>
                                            @Html.TextBoxFor(m => m.PhoneNumber, new { @class = "form-control", placeholder="Phone number :" })
                                            @Html.ValidationMessageFor(m => m.PhoneNumber)
                                        </div>
                                    </div><!--end col-->
                                </div>

                                <!--end row-->

                                <div class="row">
                                    <div class="col-sm-12">
                                        <input type="submit" id="submit" name="send" class="btn btn-primary" value="Save changes">
                                    </div><!--end col-->
                                </div>
                                <!--end row-->
                            </div>
                        }
                    </div>

                    <div class="rounded shadow mt-4">
                        <div class="p-4 border-bottom">
                            <h5 class="mb-0">Change Password :</h5>
                        </div>

                        <div class="p-4">
                            @using (Html.BeginForm("UpdatePassword", "Profile", FormMethod.Post))
                            {
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="mb-3">
                                            <label class="form-label">Old password :</label>
                                            @Html.PasswordFor(m => m.oldPassword, new { @class = "form-control", placeholder="Old password", required="" })
                                            @Html.ValidationMessageFor(m => m.oldPassword)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-lg-12">
                                        <div class="mb-3">
                                            <label class="form-label">New password :</label>
                                            @Html.PasswordFor(m => m.newPassword, new { @class = "form-control", placeholder="New password", required="" })
                                            @Html.ValidationMessageFor(m => m.newPassword)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-lg-12">
                                        <div class="mb-3">
                                            <label class="form-label">Re-type New password :</label>
                                            @Html.PasswordFor(m => m.conFirmPassword, new { @class = "form-control", placeholder="Re-type New password", required="" })
                                            @Html.ValidationMessageFor(m => m.conFirmPassword)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-lg-12 mt-2 mb-0">
                                        <button class="btn btn-primary">Save password</button>
                                    </div><!--end col-->
                                </div>

                                <!--end row-->
                            }
                        </div>
                    </div>


                    <div class="rounded shadow mt-4">
                        <div class="p-4 border-bottom">
                            <h5 class="mb-0 text-danger">Delete Account:</h5>
                        </div>
                        <div class="p-4">
                            <h6 class="mb-0 fw-normal">Do you want to delete the account? Please press the "Delete" button below:</h6>
                            <div class="mt-4">
                                <button class="btn btn-danger" onclick="showConfirmationModal()">Delete Account</button>
                            </div>
                        </div>
                    </div>

                    <div class="confirmation-modal" id="confirmationModal" style="display: none;">
                        <h5>Delete Account</h5>
                        <p>Are you sure you want to delete your account?</p>
                        <div>
                            <button class="btn btn-secondary" onclick="hideConfirmationModal()">Cancel</button>
                            <button class="btn btn-danger" onclick="confirmDeleteAccount()">Delete</button>
                        </div>
                    </div>

                    @section scripts {
                        <script>
                            function showConfirmationModal() {
                                document.getElementById("confirmationModal").style.display = "block";
                            }

                            function hideConfirmationModal() {
                                document.getElementById("confirmationModal").style.display = "none";
                            }

                            function confirmDeleteAccount() {
                                // Thực hiện xóa tài khoản tại đây
                                // Gửi yêu cầu xóa tài khoản đến server bằng Ajax hoặc form post

                                // Ví dụ sử dụng Ajax:
                                $.ajax({
                                    url: "/Profile/DeleteAccount",
                                    type: "POST"
                                });
                            }
                        </script>
                    }



                    @if (!string.IsNullOrEmpty(TempData["SuccessMessage"] as string))
                    {
                        <div id="toast" class="alert alert-success" role="alert" aria-live="assertive" aria-atomic="true" data-delay="4000">
                            <div class="toast-body">
                                @TempData["SuccessMessage"]
                            </div>
                        </div>

                        <script>
                            $(document).ready(function () {
                                $('#toast').toast('show'); // Hiển thị toast

                                // Tự động ẩn toast sau 4 giây
                                setTimeout(function () {
                                    $('#toast').toast('hide');
                                }, 4000);
                            });
                        </script>
                    }

                    @if (!string.IsNullOrEmpty(TempData["FailMessage"] as string))
                    {
                        <div id="toast" class="alert alert-danger" role="alert" aria-live="assertive" aria-atomic="true" data-delay="4000">
                            <div class="toast-body">
                                @TempData["FailMessage"]
                            </div>
                        </div>

                        <script>
                            $(document).ready(function () {
                                $('#toast').toast('show'); // Hiển thị toast

                                // Tự động ẩn toast sau 4 giây
                                setTimeout(function () {
                                    $('#toast').toast('hide');
                                }, 4000);
                            });
                        </script>
                    }
                </div><!--end col-->
            </div><!--end row-->
        </div><!--end container-->
    </section><!--end section-->
    <!-- End -->
    <!-- Back to top -->
    <a href="#" onclick="topFunction()" id="back-to-top" class="btn btn-icon btn-pills btn-primary back-to-top"><i data-feather="arrow-up" class="icons"></i></a>
    <!-- Back to top -->
    <!-- javascript -->
    <script src="../js/bootstrap.bundle.min.js"></script>
    <!-- Icons -->
    <script src="../js/feather.min.js"></script>
    <!-- Main Js -->
    <script src="../js/app.js"></script>
    <script>
        function handleImageUpload() {
            const input = document.getElementById('uploadImageInput');
            const image = document.getElementById('uploadedImage');

            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                const reader = new FileReader();

                reader.onload = (readerEvent) => {
                    image.src = readerEvent.target.result;
                    image.style.display = 'block';
                };

                if (file) {
                    reader.readAsDataURL(file);
                }
            });
        }

        function removeImage() {
            const input = document.getElementById('uploadImageInput');
            const image = document.getElementById('uploadedImage');

            input.value = ''; // Xóa giá trị của input file
            image.src = '@Url.Content("~/Avatars/" + Model.Avatar)'; // Xóa đường dẫn ảnh
            image.style.display = 'none'; // Ẩn ảnh đi
        }

        // Gọi hàm handleImageUpload() khi tài liệu được tải
        document.addEventListener('DOMContentLoaded', handleImageUpload);

    </script>
</body>
